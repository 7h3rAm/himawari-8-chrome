!function(){"use strict";function t(t){this._size=t,this._call=this._error=null,this._tasks=[],this._data=[],this._waiting=this._active=this._ended=this._start=0}function e(t){if(!t._start)try{n(t)}catch(e){if(t._tasks[t._ended+t._active-1])o(t,e);else if(!t._data)throw e}}function n(t){for(;t._start=t._waiting&&t._active<t._size;){var e=t._ended+t._active,n=t._tasks[e],o=n.length-1,a=n[o];n[o]=r(t,e),--t._waiting,++t._active,n=a.apply(null,n),t._tasks[e]&&(t._tasks[e]=n||U)}}function r(t,n){return function(r,i){t._tasks[n]&&(--t._active,++t._ended,t._tasks[n]=null,null==t._error&&(null!=r?o(t,r):(t._data[n]=i,t._waiting?e(t):a(t))))}}function o(t,e){var n,r=t._tasks.length;for(t._error=e,t._data=void 0,t._waiting=NaN;--r>=0;)if((n=t._tasks[r])&&(t._tasks[r]=null,n.abort))try{n.abort()}catch(e){}t._active=NaN,a(t)}function a(t){if(!t._active&&t._call){var e=t._data;t._data=void 0,t._call(t._error,e)}}function i(e){if(null==e)e=1/0;else if(!((e=+e)>=1))throw new Error("invalid concurrency");return new t(e)}function c(){}function s(t,e){var n=new c;if(t instanceof c)t.each(function(t,e){n.set(e,t)});else if(Array.isArray(t)){var r,o=-1,a=t.length;if(null==e)for(;++o<a;)n.set(o,t[o]);else for(;++o<a;)n.set(e(r=t[o],o,t),r)}else if(t)for(var i in t)n.set(i,t[i]);return n}function u(){}function l(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r)throw new Error("illegal type: "+t);r[t]=[]}return new f(r)}function f(t){this._=t}function h(t,e){return t.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}function d(t,e){for(var n,r=0,o=t.length;r<o;++r)if((n=t[r]).name===e)return n.value}function g(t,e,n){for(var r=0,o=t.length;r<o;++r)if(t[r].name===e){t[r]=B,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}function p(t){return function(e,n){t(null==e?n:null)}}function m(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}function v(t){return new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}")}function w(t,e){var n=v(t);return function(r,o){return e(n(r),o,t)}}function y(t){var e=Object.create(null),n=[];return t.forEach(function(t){for(var r in t)r in e||n.push(e[r]=r)}),n}function _(t){for(var e=H+((t=t||{}).type||Z),n=t.date,r=t.blocks||(t.zoom?V[t.zoom-1]:V[0]),o=r+"d",a=[n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds()].map(function(t){return b(t,2)}).join(""),i=n.getUTCFullYear(),c=b(n.getUTCMonth()+1,2),s=b(n.getUTCDate(),2),u=[e,o,Q,i,c,s,a].join("/"),l=[],f=0;f<r;f++)for(var h=0;h<r;h++){var d=h+"_"+f+".png",g=u+"_"+d;l.push({name:d,url:I(g),x:h,y:f})}return{tiles:l,blocks:r,date:n}}function E(t){if("string"==typeof t){var e=t.match(/(\d{4})-(\d{2})-(\d{2})\s(\d{2}):(\d{2}):(\d{2})Z/);return e[2]-=1,new Date(Date.UTC.apply(this,e.slice(1)))}return t}function I(t,e){return"https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?url="+t+"&container=focus&refresh="+(e||432e3)}function b(t,e){for(var n=t+"";n.length<e;)n="0"+n;return n}function k(t,e){P("https://himawari-8.appspot.com/latest"+(t===X?"?infrared=true":""),function(t,n){if(t)throw t;var r=n.date;e(E(r+"Z"))})}function T(t,e){P("http://epic.gsfc.nasa.gov/api/"+(t===Y?"enhanced":"natural"),function(t,n){if(t)throw t;if(0!==n.length){var r=n[n.length-1];r.date=E(r.date+"Z"),e(r)}})}function C(){for(var t=document.getElementById("output").clientHeight*window.devicePixelRatio/Q,e=0;e<V.length;e++){var n=V[e];if(n>t)return n}return V[V.length-1]}function S(t){var e=Math.floor((new Date-t)/1e3),n=Math.floor(e/31536e3);return n>1?n+" years":(n=Math.floor(e/2592e3))>1?n+" months":(n=Math.floor(e/86400))>1?n+" days":(n=Math.floor(e/3600))>1?n+" hours":(n=Math.floor(e/60),n>1?n+" minutes":Math.floor(e)+" seconds")}function L(t){document.getElementById("time").innerHTML=t===it?"":'<abbr title="'+t+'">'+S(t)+"</abbr> ago"}function A(t){switch(document.body.classList.remove("himawari"),document.body.classList.remove("dscovr"),document.body.classList.remove("goes"),t){case X:case Z:document.body.classList.add("himawari");break;case J:case Y:document.body.classList.add("dscovr");break;case W:case K:document.body.classList.add("goes");break;default:console.warn("Unknown image type",t)}}function x(t,e){L(t),ut=t,A(e),lt=e}function j(t,e){function n(t,e){var n=new Image;n.setAttribute("crossOrigin","anonymous"),n.onload=function(){s.drawImage(n,t.x*Q,t.y*Q,Q,Q),e()},n.src=t.url}if(!ut||t.getTime()!==ut.getTime()||lt!==e){var r=!localStorage.getItem(ot);r&&x(t,e);var o=_({date:t,blocks:C(),type:e}),a=o.blocks*Q,c=r?document.getElementById("output"):document.createElement("canvas"),s=c.getContext("2d");s.canvas.width=a,s.canvas.height=a;var u=i();o.tiles.forEach(function(t){u.defer(n,t)}),u.awaitAll(function(n){if(n)throw n;if(!r){var o=document.getElementById("output").getContext("2d");o.canvas.width=a,o.canvas.height=a,o.drawImage(c,0,0)}x(t,e);var i=c.toDataURL("image/jpeg",nt);localStorage.setItem(rt,i),localStorage.setItem(ot,t),localStorage.setItem(at,e)})}}function D(t,e){if(!ut||t.date.getTime()!==ut.getTime()||lt!==e){var n=!localStorage.getItem(ot);n&&x(t.date,e);var r=n?document.getElementById("output"):document.createElement("canvas"),o=r.getContext("2d");o.canvas.width=tt,o.canvas.height=tt;var a=new Image;a.setAttribute("crossOrigin","anonymous"),a.onload=function(){if(o.drawImage(a,0,0),!n){var i=document.getElementById("output").getContext("2d");i.canvas.width=tt,i.canvas.height=tt,i.drawImage(r,0,0)}x(t.date,e);var c=r.toDataURL("image/jpeg",nt);localStorage.setItem(rt,c),localStorage.setItem(ot,t.date),localStorage.setItem(at,e)};var i=e===Y?"enhanced":"natural",c=b(t.date.getMonth()+1,2),s=b(t.date.getDate(),2);a.src=I(""+q+i+"/"+t.date.getFullYear()+"/"+c+"/"+s+"/png/"+t.image+".png")}}function M(t){var e=localStorage.getItem(at),n=!e||e!==W&&e!==K;n&&x(it,t);var r=n?document.getElementById("output"):document.createElement("canvas"),o=r.getContext("2d");o.canvas.width=et,o.canvas.height=et;var a=new Image;a.setAttribute("crossOrigin","anonymous"),a.onload=function(){if(o.drawImage(a,0,0),!n){var e=document.getElementById("output").getContext("2d");e.canvas.width=et,e.canvas.height=et,e.drawImage(r,0,0)}x(it,t);var i=r.toDataURL("image/jpeg",nt);localStorage.setItem(rt,i),localStorage.setItem(ot,it),localStorage.setItem(at,t)},a.src=I(t===K?G:F,3600)}function O(){function t(t){k(t,function(e){j(e,t)})}function e(t){T(t,function(e){D(e,t)})}function n(t){M(t)}navigator.onLine&&(ct?st.get({imageType:Z},function(r){switch(r.imageType){case J:case Y:e(r.imageType);break;case W:case K:n(r.imageType);break;case X:case Z:default:t(r.imageType)}}):t(Z))}var R=[].slice,U={};t.prototype=i.prototype={constructor:t,defer:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("defer after await");if(null!=this._error)return this;var n=R.call(arguments,1);return n.push(t),++this._waiting,this._tasks.push(n),e(this),this},abort:function(){return null==this._error&&o(this,new Error("abort")),this},await:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=function(e,n){t.apply(null,[e].concat(n))},a(this),this},awaitAll:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=t,a(this),this}};c.prototype=s.prototype={constructor:c,has:function(t){return"$"+t in this},get:function(t){return this["$"+t]},set:function(t,e){return this["$"+t]=e,this},remove:function(t){var e="$"+t;return e in this&&delete this[e]},clear:function(){for(var t in this)"$"===t[0]&&delete this[t]},keys:function(){var t=[];for(var e in this)"$"===e[0]&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)"$"===e[0]&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)"$"===e[0]&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)"$"===e[0]&&++t;return t},empty:function(){for(var t in this)if("$"===t[0])return!1;return!0},each:function(t){for(var e in this)"$"===e[0]&&t(this[e],e.slice(1),this)}};var $=s.prototype;u.prototype=function(t,e){var n=new u;if(t instanceof u)t.each(function(t){n.add(t)});else if(t){var r=-1,o=t.length;if(null==e)for(;++r<o;)n.add(t[r]);else for(;++r<o;)n.add(e(t[r],r,t))}return n}.prototype={constructor:u,has:$.has,add:function(t){return t+="",this["$"+t]=t,this},remove:$.remove,clear:$.clear,values:$.keys,size:$.size,empty:$.empty,each:$.each};var B={value:function(){}};f.prototype=l.prototype={constructor:f,on:function(t,e){var n,r=this._,o=h(t+"",r),a=-1,i=o.length;{if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<i;)if(n=(t=o[a]).type)r[n]=g(r[n],t.name,e);else if(null==e)for(n in r)r[n]=g(r[n],t.name,null);return this}for(;++a<i;)if((n=(t=o[a]).type)&&(n=d(r[n],t.name)))return n}},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new f(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,o=new Array(n),a=0;a<n;++a)o[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=0,n=(r=this._[t]).length;a<n;++a)r[a].value.apply(e,o)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],o=0,a=r.length;o<a;++o)r[o].value.apply(e,n)}};var N=function(t,e){function n(t){var e,n=f.status;if(!n&&m(f)||n>=200&&n<300||304===n){if(a)try{e=a.call(r,f)}catch(t){return void c.call("error",r,t)}else e=f;c.call("load",r,e)}else c.call("error",r,t)}var r,o,a,i,c=l("beforesend","progress","load","error"),u=s(),f=new XMLHttpRequest,h=null,d=null,g=0;if("undefined"==typeof XDomainRequest||"withCredentials"in f||!/^(http(s)?:)?\/\//.test(t)||(f=new XDomainRequest),"onload"in f?f.onload=f.onerror=f.ontimeout=n:f.onreadystatechange=function(t){f.readyState>3&&n(t)},f.onprogress=function(t){c.call("progress",r,t)},r={header:function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?u.get(t):(null==e?u.remove(t):u.set(t,e+""),r)},mimeType:function(t){return arguments.length?(o=null==t?null:t+"",r):o},responseType:function(t){return arguments.length?(i=t,r):i},timeout:function(t){return arguments.length?(g=+t,r):g},user:function(t){return arguments.length<1?h:(h=null==t?null:t+"",r)},password:function(t){return arguments.length<1?d:(d=null==t?null:t+"",r)},response:function(t){return a=t,r},get:function(t,e){return r.send("GET",t,e)},post:function(t,e){return r.send("POST",t,e)},send:function(e,n,a){return f.open(e,t,!0,h,d),null==o||u.has("accept")||u.set("accept",o+",*/*"),f.setRequestHeader&&u.each(function(t,e){f.setRequestHeader(e,t)}),null!=o&&f.overrideMimeType&&f.overrideMimeType(o),null!=i&&(f.responseType=i),g>0&&(f.timeout=g),null==a&&"function"==typeof n&&(a=n,n=null),null!=a&&1===a.length&&(a=p(a)),null!=a&&r.on("error",a).on("load",function(t){a(null,t)}),c.call("beforesend",r,f),f.send(null==n?null:n),r},abort:function(){return f.abort(),r},on:function(){var t=c.on.apply(c,arguments);return t===c?r:t}},null!=e){if("function"!=typeof e)throw new Error("invalid callback: "+e);return r.get(e)}return r},P=function(t,e){return function(n,r){var o=N(n).mimeType(t).response(e);if(null!=r){if("function"!=typeof r)throw new Error("invalid callback: "+r);return o.get(r)}return o}}("application/json",function(t){return JSON.parse(t.responseText)}),z=function(t){function e(t,e){function n(){if(l>=u)return c;if(o)return o=!1,i;var e,n=l;if(34===t.charCodeAt(n)){for(var r=n;r++<u;)if(34===t.charCodeAt(r)){if(34!==t.charCodeAt(r+1))break;++r}return l=r+2,e=t.charCodeAt(r+1),13===e?(o=!0,10===t.charCodeAt(r+2)&&++l):10===e&&(o=!0),t.slice(n+1,r).replace(/""/g,'"')}for(;l<u;){var s=1;if(10===(e=t.charCodeAt(l++)))o=!0;else if(13===e)o=!0,10===t.charCodeAt(l)&&(++l,++s);else if(e!==a)continue;return t.slice(n,l-s)}return t.slice(n)}for(var r,o,i={},c={},s=[],u=t.length,l=0,f=0;(r=n())!==c;){for(var h=[];r!==i&&r!==c;)h.push(r),r=n();e&&null==(h=e(h,f++))||s.push(h)}return s}function n(e){return e.map(r).join(t)}function r(t){return null==t?"":o.test(t+="")?'"'+t.replace(/\"/g,'""')+'"':t}var o=new RegExp('["'+t+"\n\r]"),a=t.charCodeAt(0);return{parse:function(t,n){var r,o,a=e(t,function(t,e){if(r)return r(t,e-1);o=t,r=n?w(t,n):v(t)});return a.columns=o,a},parseRows:e,format:function(e,n){return null==n&&(n=y(e)),[n.map(r).join(t)].concat(e.map(function(e){return n.map(function(t){return r(e[t])}).join(t)})).join("\n")},formatRows:function(t){return t.map(n).join("\n")}}},H=(z(","),z("\t"),"https://himawari8-dl.nict.go.jp/himawari8/img/"),q="https://epic.gsfc.nasa.gov/archive/",F="http://goes.gsfc.nasa.gov/goescolor/goeseast/overview2/color_lrg/latestfull.jpg",G="http://goes.gsfc.nasa.gov/goescolor/goeswest/overview2/color_lrg/latestfull.jpg",X="INFRARED_FULL",Z="D531106",J="EPIC",Y="EPIC_ENHANCED",W="GOES_EAST",K="GOES_WEST",Q=550,V=[1,4,8,16,20],tt=2048,et=3072,nt=.9,rt="imageData",ot="cachedDate",at="cachedImageType",it=null,ct=window.chrome&&!!window.chrome.storage,st=window.browser?browser.storage.local:chrome.storage.sync,ut=null,lt=null;window.setInterval(O,6e4),window.addEventListener("online",O),localStorage.getItem(ot)&&function(){var t=document.getElementById("output").getContext("2d"),e=new Date(localStorage.getItem(ot)),n=new Image;n.onload=function(){t.canvas.width=n.width,t.canvas.height=n.height,t.drawImage(n,0,0),x(e,localStorage.getItem(at))},n.src=localStorage.getItem(rt)}(),O(),window.setInterval(function(){ut&&L(ut)},1e4),ct&&(chrome.storage.onChanged.addListener(O),document.body.classList.add("extension"),document.getElementById("go-to-options").addEventListener("click",function(){chrome.runtime.openOptionsPage()})),document.getElementById("explore").addEventListener("click",function(){window.open(lt===J?"https://epic.gsfc.nasa.gov":lt===Y?"https://epic.gsfc.nasa.gov/enhanced":"http://himawari8.nict.go.jp/himawari8-image.htm?sI=D531106","_self")})}();
//# sourceMappingURL=bundle.js.map
